<!DOCTYPE html>
<html lang="en">
<head>
  <title>User Profile</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  (function () {
    function parseJwt(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        return JSON.parse(atob(base64));
      } catch (e) { return null; }
    }

    const token = localStorage.getItem("id_token");
    if (!token) {
      window.location.href = "index.html";
      return;
    }

    document.addEventListener("DOMContentLoaded", function () {
      const payload = parseJwt(token);
      if (!payload) return;

      document.getElementById("p_name").textContent = payload.name || "-";
      document.getElementById("p_email").textContent = payload.email || "-";
      document.getElementById("p_username").textContent = payload["cognito:username"] || "-";
      document.getElementById("p_sub").textContent = payload.sub || "-";
      document.getElementById("p_issuer").textContent = payload.iss || "-";
      document.getElementById("p_expires").textContent =
        new Date(payload.exp * 1000).toLocaleString();
    });
  })();
  </script>
</head>

<body>
<div class="container mt-5">
  <h2>User Profile</h2>
  <table class="table table-bordered mt-3">
    <tr><th>Name</th><td id="p_name"></td></tr>
    <tr><th>Email</th><td id="p_email"></td></tr>
    <tr><th>Username</th><td id="p_username"></td></tr>
    <tr><th>User ID (sub)</th><td id="p_sub"></td></tr>
    <tr><th>Issuer</th><td id="p_issuer"></td></tr>
    <tr><th>Token Expires</th><td id="p_expires"></td></tr>
  </table>

  <a href="index.html" class="btn btn-secondary">Back</a>
</div>
</body>
</html>
